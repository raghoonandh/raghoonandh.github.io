"use strict";function _toArray(t){return Array.isArray(t)?t:Array.from(t)}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function noop(){}function constant(t){return function(){return t}}function each(t,e){for(var r in t)t.hasOwnProperty(r)&&e(r,t[r])}function parse_event(t){var e="",r=t,n=t.indexOf(".");return n>=0&&(e=t.slice(n+1)||"*",r=t.slice(0,n)||"*"),{name:e,type:r}}function padded(t,e){var r=t.padding()||{};return"function"==typeof r&&(r=r(e)),attrs.forEach(function(t){"function"==typeof r[t]&&(r[t]=r[t](e)),"number"!=typeof r[t]&&(r[t]=0)}),{left:r.left,top:r.top,width:e.width-r.left-r.right,height:e.height-r.top-r.bottom}}function add_namespaced_store(t,e,r,n){function o(t,a,i){var s=this;if(Array.isArray(t))return t.forEach(function(t){o.bind(s)(t,a,i)}),s;if("object"==("undefined"==typeof t?"undefined":_typeof(t)))return each(t,o.bind(s)),s;var c,l,u,p,f=s[r],h=parse_event(t||"."),d=h.type,_=h.name,y="*"==d,b="*"==_;if(arguments.length<=1)return y&&b?f:y?f.filter(function(t){return t[1]==_}):b?f.filter(function(t){return t[0]==d}):(p=f.filter("?"==_?function(t){return t[0]==d}:"?"==d?function(t){return t[1]==_}:function(t){return t[0]==d&&t[1]==_}),p.length>0?p[0][2]:p[0]);if(null===a)if(y&&b)f.length=0;else if(y)for(c=f.length,l;c--;)l=f[c],l[1]==_&&f.splice(c,1);else if(b)for(c=f.length,l;c--;)l=f[c],l[0]==d&&f.splice(c,1);else for(c=f.length,l;c--;)l=f[c],l[0]==d&&l[1]==_&&f.splice(c,1);else{if(!d||y)throw new TypeError("."+e+'("'+t+'", ...) is invalid. Use "<type>.<name>"');if("function"==typeof n&&!n(a))throw new TypeError("."+e+'("'+t+'", '+a+") has an invalid value");if("undefined"!=typeof i&&"number"!=typeof i)throw new TypeError("."+e+'("'+t+'", '+a+", "+i+"): "+i+" be a number");for(c=0,u=null,l;l=f[c];c++)l[0]==d&&l[1]==_&&(u=l[2]=a===noop?l[2]:a,"number"==typeof i&&i!=c&&f.splice(i,0,f.splice(c,1)[0]));null===u&&f.splice("number"==typeof i?i:f.length,0,[d,_,a])}return s}Object.defineProperty(t.prototype,e,{value:o,__proto__:null})}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function domain_extender(t,e,r){var n=e+"scale",o=e+"0",a=e+"0_value";return r?function(){var r=t[n],o=r(),a=t.data().map(t[e]());if(r._has_domain){var i=o.domain(),s=a.filter(function(t){return i.indexOf(t)<0});o.domain(i.concat(s))}else o.domain(a),r._has_domain=!0;return o}:function(){var r=t[n],i=r(),s=d3.extent(t.data(),t[e]()),c=t[o]();return"undefined"!=typeof c?(s[0]>c&&(s[0]=c),s[1]<c&&(s[1]=c)):c=s[0],t[a]=c,r._has_domain?i.domain(d3.extent([].concat(_toConsumableArray(i.domain()),_toConsumableArray(s)))):(i.domain(s),r._has_domain=!0),i}}function _draw_rect(t){var e=this.interpolate();t.attr("d",function(t){var r=t.pos;return d3.line().curve(_curve_map[e])([[r.x,r.y1],[r.x,r.y],[r.x1,r.y],[r.x1,r.y1]])})}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),svg_ns="http://www.w3.org/2000/svg",global=window,CHILDREN="_children",CALLBACKS="_callbacks",LINKCOUNT="_linkcount",PROPERTIES="_properties",Dispatcher=function(){function t(){_classCallCheck(this,t),Object.defineProperty(this,PROPERTIES,{value:{},__proto__:null}),Object.defineProperty(this,CALLBACKS,{value:[],__proto__:null})}return _createClass(t,[{key:"prop",value:function(t,e){var r=this;if(0==arguments.length){var n={};return each(r[PROPERTIES],function(t){n[t]=r[t]()}),n}if(Array.isArray(t))return t.forEach(function(t){r.prop(t)}),r;if("object"==("undefined"==typeof t?"undefined":_typeof(t)))return each(t,r.prop.bind(r)),r;1==arguments.length&&(e="_"+t);var o;if("function"==typeof r[t]&&(o=r[t]()),"string"==typeof e)r[t]=function(n){return 0==arguments.length?r[e]:(null===n?delete r[e]:r[e]=n,r.trigger(t,n,t))};else if("function"==typeof e)r[t]=function(n){return 0==arguments.length?e():(e(n),r.trigger(t,n,t))};else{if("object"!=("undefined"==typeof e?"undefined":_typeof(e)))throw new TypeError('Invalid value: .prop("'+t+'", '+e+")");r[t]=function(n){return 0==arguments.length?e:(null===n?each(e,function(t){delete e[t]}):"object"==("undefined"==typeof n?"undefined":_typeof(n))?each(n,function(t,r){null===r?delete e[t]:e[t]=r}):each(e,function(t){e[t]=n}),r.trigger(t,e,t))}}return r[PROPERTIES][t]=e,"undefined"==typeof r[t]()&&"undefined"!=typeof o&&r[t](o),r}},{key:"call",value:function(t){return t(this),this}},{key:"trigger",value:function(t){var e=parse_event(t),r=e.type,n=Array.from(arguments).slice(1),o=this;return r&&o.on(r+".*").forEach(function(t){t[2].apply(o,n)}),o}}]),t}();add_namespaced_store(Dispatcher,"on",CALLBACKS,function(t){return"function"==typeof t});var Container=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return Object.defineProperty(t,CHILDREN,{value:[],__proto__:null}),Object.defineProperty(t,LINKCOUNT,{value:0,__proto__:null,writable:!0}),t}return _inherits(e,t),_createClass(e,[{key:"link",value:function(t,e){var r=this;if(Array.isArray(t)&&Array.isArray(e))return t.forEach(function(t){for(var n=[t],o=0,a=e.length;a>o;o++)n.push([e[o],t]);r.link.apply(r,n)}),r;var n=Array.from(arguments).slice(1);return r[t]||r.prop(t),n=n.map(function(e){var n=e[0];return"string"==typeof n&&(n=r.child(n)||n),"function"==typeof n.prop&&n.prop(e[1],r[t]),[n,e[1]]}),r.on(t+".link"+r[LINKCOUNT]++,function(t){for(var e=0,r=n.length;r>e;e++)n[e][0].trigger(n[e][1],t,n[e][1])}),r}},{key:"childprop",value:function(){var t=this,e=this.child(),r=e.map(function(t){return t[2].prop()});return Array.from(arguments).forEach(function(n){t.link([n],e.filter(function(t,e){return r[e].hasOwnProperty(n)}).map(function(t){return t[2]}))}),t}}]),e}(Dispatcher);add_namespaced_store(Container,"child",CHILDREN);var size_methods={svg:function(t){if(t.namespaceURI&&t.namespaceURI==svg_ns){for(;!t.nodeName.match(/svg/i);)t=t.parentNode;return t.getAttribute("viewBox")?t.viewBox.baseVal:{width:t.width.baseVal.value,height:t.height.baseVal.value}}},bounds:function(t){return t.getBoundingClientRect?t.getBoundingClientRect():void 0}},attrs=["top","left","bottom","right"],name_count=0,Chart=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.options=t||{},r.options.name=r.options.name||"name_"+name_count++,r.prop(["data","update","enter","exit"]).prop("padding",{left:0,right:0,top:0,bottom:0}).prop("defined").defined(constant(!0)),r}return _inherits(e,t),_createClass(e,[{key:"size",value:function r(t){for(var e in size_methods)if(size_methods.hasOwnProperty(e)){var r=size_methods[e](t);if(r&&r.width>0&&r.height>0)return padded(this,r)}var n=t.parentNode;return n?this.size(n):{width:0,height:0}}},{key:"draw",value:function(t){if("string"==typeof t)t=document.querySelector(t);else if("function"==typeof t.node)t=t.node();else if(!(t instanceof Node))throw new TypeError(".draw() needs a single selector, node or d3 selection");return this.trigger("predraw",t,"predraw"),this.child().forEach(function(e){var r,n=e[0],o=e[2],a=[],i=/^\s*<\s*(.*?)\s*>\s*$/;e[1].split(".").forEach(function(t){var e=i.exec(t);e?r=e[1]:a.push(t)}),a=a.join(".");var s="."+n+(a?"."+a:""),c=n+(a?" "+a.replace("."," "):""),l=t.namespaceURI,u=t.querySelector(s);null===u&&(r=r||(l.match(/svg/)?"g":"div"),u=l.match(/svg/i)||r.match(/^svg$/i)?document.createElementNS(svg_ns,r):document.createElement(r),u.setAttribute("class",c),t.appendChild(u)),"function"==typeof o.draw&&o.draw(u)}),this.trigger("draw",t,"draw")}},{key:"join",value:function(t,e){return this.on("predraw.join",global.join(t,e))}}]),e}(Container);global.join=function(t,e){t=t||"";var r=t.split("."),n=_toArray(r),o=n[0],a=n.slice(1);return a=a.join(" "),function(r){var n=this.options.name,i=d3.select(r).selectAll(t+"."+n).data((e||this.data)()),s=i.enter().append(o||(r.namespaceURI.match(/svg/)?"g":"div")).classed(a+" "+n,!0),c=i.exit().remove();this.update("function"==typeof s.merge?s.merge(i):i),this.enter(s),this.exit(c)}},global.draw=function(t,e){var r=t.split("."),n=_toArray(r),o=n[0],a=n.slice(1);return a=a.join(" "),"function"!=typeof e&&(e=noop),function(){var r=this.update().filter(this.defined()).each(function(){var e=d3.select(this);null===e.select(t).node()&&e.append(o).classed(a,!0)}).select(t);e.call(this,r)}};var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_axis_map={top:d3.axisTop,bottom:d3.axisBottom,left:d3.axisLeft,right:d3.axisRight},_curve_map={linear:d3.curveLinear,"linear-closed":d3.curveLinearClosed,step:d3.curveStep,"step-after":d3.curveStepAfter,"step-before":d3.curveStepBefore,basis:d3.curveBasis,"basis-open":d3.curveBasisOpen,"basis-closed":d3.curveBasisClosed,bundle:d3.curveBundle,cardinal:d3.curveCardinal,"cardinal-open":d3.curveCardinalOpen,"cardinal-closed":d3.curveCardinalClosed,monotone:d3.curveMonotoneX},_scale_info={linear:{scale:d3.scaleLinear,ordinal:!1,accessor:constant(0)},pow:{scale:d3.scalePow,ordinal:!1,accessor:constant(0)},sqrt:{scale:d3.scaleSqrt,ordinal:!1,accessor:constant(0)},log:{scale:d3.scaleLog,ordinal:!1,accessor:constant(1)},time:{scale:d3.scaleTime,ordinal:!1,accessor:constant(new Date)},point:{scale:d3.scalePoint,ordinal:!0,accessor:function(t,e){return e}},band:{scale:d3.scaleBand,ordinal:!0,accessor:function(t,e){return e}}},Axis=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),n=r.options.orient||"bottom";return r.prop("axis").axis(_axis_map[n]()).prop("scale").scale(d3.scaleIdentity()).prop("position").on("draw.axis",r.render),r}return _inherits(e,t),_createClass(e,[{key:"render",value:function(t){var e=this.axis().scale(this.scale());d3.select(t).call(e)}}]),e}(Chart),XYChart=function(t){function e(t){_classCallCheck(this,e),t=Object.assign({xscale:"linear",yscale:"linear",xaxis:"bottom",yaxis:"left"},t);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return t.x=_scale_info[t.xscale],t.y=_scale_info[t.yscale],r.prop("xscale").xscale(t.x.scale()).prop("x").x(t.x.accessor).prop("yscale").yscale(t.y.scale()).prop("y").y(t.y.accessor).prop("interpolate").interpolate("linear").on("predraw.layout",r.layout).join().on("draw.axes",r.axes).on("draw.render",r.render),t.x.ordinal||r.prop("x0"),t.y.ordinal||r.prop("y0"),r.xextend=domain_extender(r,"x",t.x.ordinal),r.yextend=domain_extender(r,"y",t.y.ordinal),r.child("xaxis",new Axis({orient:t.xaxis})).link("xscale",["xaxis","scale"]),r.child("yaxis",new Axis({orient:t.yaxis})).link("yscale",["yaxis","scale"]),t.labels&&r.child("labels",(new Chart).join(".label")).link(["data","defined","x","y"],["labels"]).child("labels").on("draw.render",r.labels),r}return _inherits(e,t),_createClass(e,[{key:"layout",value:function(t){var e,r,n=this.data(),o=this.x(),a=this.y(),i=this.size(t),s=this.xextend(),c=this.yextend();s.range("right"==this.options.yaxis?[i.left+i.width,i.width]:[i.left,i.left+i.width]),c.range("bottom"==this.options.xaxis?[i.top+i.height,i.top]:[i.top,i.top+i.height]),n.forEach(function(t,e){t.pos={x:+s(o(t,e)),y:+c(a(t,e))}}),this.options.x.ordinal?(e=+s.bandwidth(),n.forEach(function(t){t.pos.x1=t.pos.x+e})):(r=+s(this.x0_value),n.forEach(function(t){t.pos.x1=r})),this.options.y.ordinal?(e=+c.bandwidth(),n.forEach(function(t){t.pos.y1=t.pos.y+e})):(r=+c(this.y0_value),n.forEach(function(t){t.pos.y1=r}))}},{key:"axes",value:function(t){var e=this.size(t);d3.select(t).select(".yaxis").attr("transform","translate("+(this.options.x.ordinal?e.left:this.xscale()(this.x0_value))+",0)"),d3.select(t).select(".xaxis").attr("transform","translate(0,"+(this.options.y.ordinal?e.top:this.yscale()(this.y0_value))+")")}},{key:"render",value:function(){}}]),e}(Chart),VerticalChart=function(t){function e(t){return _classCallCheck(this,e),t=Object.assign({name:"vertical",xscale:"band",yscale:"linear",xaxis:"bottom",yaxis:"left"},t),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return _inherits(e,t),e}(XYChart);VerticalChart.prototype.labels=draw("text.vertical-label",function(t){var e=this,r=this.y();t.attr("transform",function(t){return"translate("+(t.pos.x+t.pos.x1)/2+","+t.pos.y+")"}).attr("text-anchor","middle").attr("dy",function(t){return r(t)<e.y0_value?"1em":"-0.37em"}).text(function(t){return r(t)})});var JitterChart=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,t),e}(VerticalChart);JitterChart.prototype.render=draw("circle.dot",function(t){t.attr("cx",function(t){return t.pos.x+Math.random()*(t.pos.x1-t.pos.x)}).attr("cy",function(t){return t.pos.y}).attr("r",1)});var BarChart=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,t),e}(VerticalChart);BarChart.prototype.render=draw("path.bar",_draw_rect);var CombChart=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,t),e}(VerticalChart);CombChart.prototype.render=draw("path.comb",function(t){t.attr("d",function(t){return"M"+(t.pos.x+t.pos.x1)/2+","+t.pos.y+"V"+t.pos.y1})});var LineChart=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.join(".line",constant([0])),r}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){var t=d3.line().defined(this.defined()).x(function(t){return(t.pos.x+t.pos.x1)/2}).y(function(t){return t.pos.y}).curve(_curve_map[this.interpolate()]);this.enter().append("path").classed("line",!0),this.update().select(".line").attr("d",t(this.data()))}}]),e}(VerticalChart),AreaChart=function(t){function e(t){return _classCallCheck(this,e),t=Object.assign({xscale:"point"},t),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){var t=this.data(),e=d3.area().defined(this.defined()).x(function(t){return(t.pos.x+t.pos.x1)/2}).y1(function(t){return t.pos.y}).curve(_curve_map[this.interpolate()]);e.y0(this.yscale()(this.y0_value)),this.enter().append("path").classed("area",!0),this.update().select(".area").attr("d",e(t))}}]),e}(LineChart),MatrixChart=function(t){function e(t){return _classCallCheck(this,e),t=Object.assign({name:"grid",xscale:"band",yscale:"band",xaxis:"top",yaxis:"left"},t),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return _inherits(e,t),e}(XYChart),DotChart=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,t),e}(MatrixChart);DotChart.prototype.render=draw("circle.dot",function(t){t.attr("cx",function(t){return(t.pos.x+t.pos.x1)/2}).attr("cy",function(t){return(t.pos.y+t.pos.y1)/2}).attr("r",1)});var GridChart=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,t),e}(MatrixChart);GridChart.prototype.render=draw("path.grid",_draw_rect);var HorizontalChart=function(t){function e(t){return _classCallCheck(this,e),t=Object.assign({name:"horizontal",xscale:"linear",yscale:"band",xaxis:"top",yaxis:"left"},t),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return _inherits(e,t),e}(XYChart),HorizontalBarChart=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,t),e}(HorizontalChart);HorizontalBarChart.prototype.render=draw("path.horizontalbar",_draw_rect);var HorizontalCombChart=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,t),e}(HorizontalChart);HorizontalCombChart.prototype.render=draw("path.horizontalcomb",function(t){t.attr("d",function(t){return"M"+t.pos.x+","+(t.pos.y+t.pos.y1)/2+"H"+t.pos.x1})});var PointChart=function(t){function e(t){return _classCallCheck(this,e),t=Object.assign({name:"point",xscale:"linear",yscale:"linear",xaxis:"bottom",yaxis:"left"},t),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return _inherits(e,t),e}(XYChart),ScatterChart=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,t),e}(PointChart);ScatterChart.prototype.render=draw("circle.dot",function(t){t.attr("cx",function(t){return t.pos.x}).attr("cy",function(t){return t.pos.y}).attr("r",1)});var ScatterLineChart=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.join(".line",constant([0])),r}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){var t=d3.line().defined(this.defined()).x(function(t){return t.pos.x}).y(function(t){return t.pos.y}).curve(_curve_map[this.interpolate()]);this.enter().append("path").classed("line",!0),this.update().select(".line").attr("d",t(this.data()))}}]),e}(ScatterChart);