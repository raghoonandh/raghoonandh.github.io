<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
</head>
<body>
  <table></table>

  <script src="bower_components/d3/d3.min.js"></script>
  <script src="chart.js"></script>
  <script>
  var data = [
      [1,2,3],
      [3,4,5],
      [4,5,7]
  ]

  class TableChart extends Chart {
    constructor(options) {
      super(options)
      var headerchart = new Chart()
          .join('td.head')
          .on('draw', this.renderheader)
      var bodychart = new Chart()
          .join('tr.row')
          .on('draw', this.renderbody)
      this.child('header.<thead>', headerchart)
          .child('body.<tbody>', bodychart)
          .link('data', [bodychart, 'data'])
          .on('data.set-header', function(data) {
            headerchart.data(data.length > 0 ? data[0] : [])
          })
    }

    renderbody(node) {
      this.update().each(function(row) {
        var subchart = new Chart()
            .join('td.cell')
            .on('draw', function(node) {
              this.update().text(function(d) { return d })
            })
            .data(row)
            .draw(this)
        this.chart = subchart
      })
    }

    renderheader(node) {
      this.update().text(function(d, i) { return 'Col ' + i })
    }
  }

  var tablechart = new TableChart()
      .on('draw', function(node) {
        this.child('body.<tbody>')    // Think about this....
          .update()
          .each(function(row, i) {
            this.chart                // Think about this....
                .enter()
                .filter(function(d, i) { return i == 1 })
                .append('svg')
                  .attr('width', 200)
                  .attr('height', 10)
                  .append('path')
                    .attr('fill', 'blue')
            this.chart               // Think about .chart
                .update()
                .filter(function(d, i) { return i == 1 })
                .select('path')
                .attr('d', function(value) {
                  return `M0,0h${value * 10}v10h-${value * 10}z`
                })
          })
      })
      .data(data)
      .draw('table')
  </script>

</body>
</html>
